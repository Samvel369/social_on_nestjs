{% extends "base.html" %}
{% block title %}Добро пожаловать{% endblock %}

{% block content %}
<div class="welcome-section">
  <h1 style="font-size: 56px;">
    Добро пожаловать в Наш Мир
  </h1>
  <p style="font-size: 22px; max-width: 800px;">
    <strong style="color: var(--accent-connection);">Никто не один в своих моментах.</strong><br>
    Кто-то пьёт чай прямо сейчас. Кто-то грустит. Кто-то смеётся.<br>
    Найди тех, кто переживает то же, что и ты. В эту же секунду.
  </p>
  
  <div class="world-pulse">
    <div class="pulse-ring"></div>
    <div class="pulse-ring"></div>
    <div class="pulse-ring"></div>
    <div class="pulse-core">
      <i class="fa-solid fa-earth-americas"></i>
    </div>
  </div>
</div>

<h2 style="display: flex; align-items: center; justify-content: center; gap: 12px; margin-top: 60px; margin-bottom: 32px;">
  <i class="fa-solid fa-fire"></i>
  Прямо сейчас популярны действия
</h2>

<ul id="top-actions-list">
  <li>Загрузка...</li>
</ul>

<div style="text-align: center; margin-top: 60px;">
  <a href="/api/auth/login" class="btn" style="padding: 18px 40px; font-size: 18px; text-decoration: none;">
    <i class="fa-solid fa-right-to-bracket"></i>
    Войти и начать
  </a>
</div>

<script>
function updateTopActions() {
  fetch('/api/actions/get_top_actions')
    .then(r => r.json())
    .then(data => {
      const list = document.getElementById('top-actions-list');
      
      if (!Array.isArray(data) || data.length === 0) {
        list.innerHTML = '<li style="text-align: center; color: var(--text-muted);">Нет активных действий</li>';
        return;
      }

      const newContent = data.map((action, idx) => {
        return `<li data-id="${action.id}">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <span style="flex: 1;">
              <strong style="color: var(--accent-pulse);">${idx + 1}.</strong> ${action.text}
            </span>
            <span style="font-weight: 700; color: var(--accent-connection); font-size: 18px; min-width: 60px; text-align: right;">
              ${action.marks ?? 0} <i class="fa-solid fa-user" style="font-size: 14px; opacity: 0.7;"></i>
            </span>
          </div>
        </li>`;
      }).join('');

      if (list.innerHTML !== newContent) {
        list.innerHTML = newContent;
      }
    })
    .catch(() => {});
}

updateTopActions();
setInterval(updateTopActions, 1000);
</script>
{% endblock %}
