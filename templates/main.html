{% extends "base.html" %}
{% block title %}Главная{% endblock %}

{% block content %}
<div class="welcome-section">
  <h1>
    <i class="fa-solid fa-house"></i>
    Добро пожаловать
  </h1>
  <p>
    Никто не один в своих моментах.<br>
    Вот что происходит с людьми прямо сейчас
  </p>
</div>

<h2 style="display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 32px;">
  <i class="fa-solid fa-fire"></i>
  Топ 10 действий за последнюю минуту
</h2>

<ul id="top-actions-list">
  <li>Загрузка...</li>
</ul>

<script>
function updateTopActions() {
  fetch('/api/actions/get_top_actions', { credentials: 'include' })
    .then(r => r.json())
    .then(data => {
      const list = document.getElementById('top-actions-list');
      
      if (!Array.isArray(data) || data.length === 0) {
        // Проверяем, не показываем ли уже сообщение об отсутствии действий
        const currentText = list.textContent?.trim();
        if (currentText !== 'Нет активных действий') {
          list.innerHTML = '<li style="text-align: center; color: var(--text-muted);">Нет активных действий</li>';
        }
        return;
      }

      // Сравниваем с текущим контентом
      const currentContent = list.innerHTML;
      const newContent = data.map((action, idx) => {
        return `<li data-id="${action.id}">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <a href="/api/actions/action_card/${action.id}" target="_blank" style="flex: 1;">
              <strong style="color: var(--accent-pulse);">${idx + 1}.</strong> ${action.text}
            </a>
            <span style="font-weight: 700; color: var(--accent-connection); font-size: 18px; min-width: 60px; text-align: right;">
              ${action.marks ?? 0} <i class="fa-solid fa-user" style="font-size: 14px; opacity: 0.7;"></i>
            </span>
          </div>
        </li>`;
      }).join('');

      if (currentContent !== newContent) {
        list.innerHTML = newContent;
      }
    })
    .catch(() => {});
}

updateTopActions();
setInterval(updateTopActions, 1000);
</script>
{% endblock %}
