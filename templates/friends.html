{% extends 'base.html' %}

{% block content %}
<div style="display: flex; flex-direction: column; gap: 30px;">

<!-- –í–æ–∑–º–æ–∂–Ω—ã–µ –¥—Ä—É–∑—å—è -->
<section>
  <h2>–í–æ–∑–º–æ–∂–Ω—ã–µ –¥—Ä—É–∑—å—è:</h2>

    <form method="POST" style="margin: 6px 0;">
      <label>–£–¥–∞–ª—è—Ç—å –∏–∑ —Å–ø–∏—Å–∫–∞ —á–µ—Ä–µ–∑:</label>
      <select name="cleanup_time" onchange="this.form.submit()">
        <option value="10" {{ 'selected' if cleanup_time == 10 else '' }}>10 –º–∏–Ω</option>
        <option value="30" {{ 'selected' if cleanup_time == 30 else '' }}>30 –º–∏–Ω</option>
        <option value="60" {{ 'selected' if cleanup_time == 60 else '' }}>1 —á–∞—Å</option>
      </select>
    </form>

    {# –í–ê–ñ–ù–û: –∏–º–µ–Ω–Ω–æ —ç—Ç–æ—Ç id –º—ã –æ–±–Ω–æ–≤–ª—è–µ–º –∏–∑ friends.js #}
    <div id="possible-friends-list">
      {% include 'partials/possible_friends.html' %}
    </div>
</section>

  <hr>

  <!-- –í—Ö–æ–¥—è—â–∏–µ –∑–∞—è–≤–∫–∏ -->
  <section>
    <h2>–í—Ö–æ–¥—è—â–∏–µ –∑–∞—è–≤–∫–∏:</h2>
    <div id="requests-list">
    {% if incoming_requests %}
      {% for req in incoming_requests %}
        <div data-request-id="{{ req.id }}" style="display: flex; align-items: center; margin-bottom: 20px;">
          <img src="{{ req.sender.avatar_url }}" alt="avatar"
               style="width: 60px; height: 60px; object-fit: cover; border-radius: 50%; margin-right: 15px;">
          <div style="flex-grow: 1;">
            <strong><a href="/profile/req.sender.id">{{ req.sender.username }}</a></strong><br>
            <a href="/profile/req.sender.id">–ü–µ—Ä–µ–π—Ç–∏ –≤ –ø—Ä–æ—Ñ–∏–ª—å</a>
          </div>
          <form method="post" action="# TODO: replace_url_for(friends_bp.accept_friend_request', request_id=req.id) }}" style="margin-right: 5px;">
            <button type="submit">–ü—Ä–∏–Ω—è—Ç—å</button>
          </form>
          <form method="POST" action="# TODO: replace_url_for(friends_bp.cancel_friend_request', request_id=req.id) }}">
              <input type="hidden" name="subscribe" value="true">
              <button type="submit">–û—Å—Ç–∞–≤–∏—Ç—å –≤ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞—Ö</button>
          </form>
        </div>
      {% endfor %}
    {% else %}
      <p>–ù–µ—Ç –≤—Ö–æ–¥—è—â–∏—Ö –∑–∞—è–≤–æ–∫.</p>
    {% endif %}
    </div>
  </section>

  <hr>

  <!-- –ò—Å—Ö–æ–¥—è—â–∏–µ –∑–∞—è–≤–∫–∏ -->
  <section>
    <h2>–ò—Å—Ö–æ–¥—è—â–∏–µ –∑–∞—è–≤–∫–∏:</h2>
    <div id="outgoing-requests">
    {% if outgoing_requests %}
      {% for req in outgoing_requests %}
        <div data-request-id="{{ req.id }}" style="display: flex; align-items: center; margin-bottom: 20px;">
          <img src="{{ req.receiver.avatar_url }}" alt="avatar"
               style="width: 60px; height: 60px; object-fit: cover; border-radius: 50%; margin-right: 15px;">
          <div style="flex-grow: 1;">
            <strong><a href="/profile/req.receiver.id">{{ req.receiver.username }}</a></strong><br>
            <a href="/profile/req.receiver.id">–ü–µ—Ä–µ–π—Ç–∏ –≤ –ø—Ä–æ—Ñ–∏–ª—å</a>
          </div>
          <form method="post" action="# TODO: replace_url_for(friends_bp.cancel_friend_request', request_id=req.id) }}">
            <button type="submit">–û—Ç–º–µ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É</button>
          </form>
        </div>
      {% endfor %}
    {% else %}
      <p>–ù–µ—Ç –∏—Å—Ö–æ–¥—è—â–∏—Ö –∑–∞—è–≤–æ–∫.</p>
    {% endif %}
    </div>
  </section>

  <hr>

  <!-- –î—Ä—É–∑—å—è -->
  <section>
    <h2>–ú–æ–∏ –¥—Ä—É–∑—å—è:</h2>
    <div id="friends-list">
    {% if friends %}
      {% for user in friends %}
        <div style="display: flex; align-items: center; margin-bottom: 20px;">
          <img src="{{ user.avatar_url }}" alt="avatar"
               style="width: 60px; height: 60px; object-fit: cover; border-radius: 50%; margin-right: 15px;">
          <div style="flex-grow: 1;">
            <strong><a href="/profile/user.id">{{ user.username }}</a></strong><br>
            <a href="/profile/user.id">–ü–µ—Ä–µ–π—Ç–∏ –≤ –ø—Ä–æ—Ñ–∏–ª—å</a>
          </div>
          <form method="post" action="# TODO: replace_url_for(friends_bp.remove_friend', user_id=user.id) }}">
            <button type="submit">–£–¥–∞–ª–∏—Ç—å –∏–∑ –¥—Ä—É–∑–µ–π</button>
          </form>
        </div>
      {% endfor %}
    {% else %}
      <p id="no-friends-msg">–ü–æ–∫–∞ –Ω–µ—Ç –¥—Ä—É–∑–µ–π.</p>
    {% endif %}
    </div>
  </section>

  <hr>

  <section>
    <h2>–ü–æ–¥–ø–∏—Å—á–∏–∫–∏:</h2>
    <div id="subscribers-list">
    {% if subscribers %}
      {% for subscriber in subscribers %}
        <div style="display: flex; align-items: center; margin-bottom: 20px;">
          <img src="{{ subscriber.avatar_url }}" alt="avatar"
              style="width: 60px; height: 60px; object-fit: cover; border-radius: 50%; margin-right: 15px;">
          <div style="flex-grow: 1;">
            <strong>
              <a href="/profile/subscriber.id">
                {{ subscriber.username }}
              </a>
            </strong>
            <br>
            <a href="/profile/subscriber.id">–ü–µ—Ä–µ–π—Ç–∏ –≤ –ø—Ä–æ—Ñ–∏–ª—å</a>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <p id="no-subscribers-msg">–ù–µ—Ç –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤.</p>
    {% endif %}
    </div>
  </section>

  <!-- üîΩ –ù–æ–≤—ã–π –±–ª–æ–∫ "–ü–æ–¥–ø–∏—Å–∞–Ω –Ω–∞:" -->
  <section>
    <h2>–ü–æ–¥–ø–∏—Å–∞–Ω –Ω–∞:</h2>
    <div id="subscriptions-list">
      {% if subscriptions %}
        {% for user in subscriptions %}
          <div style="display: flex; align-items: center; margin-bottom: 20px;">
            <img src="{{ user.avatar_url }}" alt="avatar"
                style="width: 60px; height: 60px; object-fit: cover; border-radius: 50%; margin-right: 15px;">
            <div style="flex-grow: 1;">
              <strong>
                <a href="/profile/user.id">
                  {{ user.username }}
                </a>
              </strong>
              <br>
              <a href="/profile/user.id">–ü–µ—Ä–µ–π—Ç–∏ –≤ –ø—Ä–æ—Ñ–∏–ª—å</a>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <p id="no-subscriptions-msg">–í—ã –Ω–∏ –Ω–∞ –∫–æ–≥–æ –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω—ã.</p>
      {% endif %}
    </div>
  </section>

</div>

<script src="/static/js/socket.js"></script>

<script>
  window.FRIENDS_PARTIALS = {
    possible_friends: "# TODO: replace_url_for(friends_bp.friends_partial') }}",
    incoming: "# TODO: replace_url_for(friends_bp.friends_partial_incoming') }}",
    outgoing: "# TODO: replace_url_for(friends_bp.friends_partial_outgoing') }}",
    friends: "# TODO: replace_url_for(friends_bp.friends_partial_friends') }}",
    subscribers: "# TODO: replace_url_for(friends_bp.friends_partial_subscribers') }}",
    subscriptions: "# TODO: replace_url_for(friends_bp.friends_partial_subscriptions') }}"
  };
</script>

<script src="/static/js/friends.js"></script>


{% endblock %}
