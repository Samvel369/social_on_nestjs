# üìù Changelog

## 2026-02-13

### –ù–∞–≤–∏–≥–∞—Ü–∏—è –∏ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- **–°–∞–π–¥–±–∞—Ä:** –£–±—Ä–∞–Ω–∞ –≤–∫–ª–∞–¥–∫–∞ "–ì–ª–∞–≤–Ω–∞—è", –∏–∑–º–µ–Ω–µ–Ω –ø–æ—Ä—è–¥–æ–∫ (–ù–∞—à –º–∏—Ä, –ú–æ–∏ –¥–µ–π—Å—Ç–≤–∏—è, –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –ß–∞—Ç...).
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:** –ù–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ `/statistics` —Å –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- **–í–∫–ª–∞–¥–∫–∏ "–ù–∞—à –º–∏—Ä":** –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∫–ª–∞–¥–∫–∞ "–¢–æ–ø 10" (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é), –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω—ã "–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ" -> "–°–µ–π—á–∞—Å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç", "–°–µ–π—á–∞—Å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç" -> "–°–æ–∑–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ".

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- **Prisma:** –û–±–Ω–æ–≤–ª–µ–Ω Prisma Client –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ `DailyAction`.
- **–†–æ—É—Ç–∏–Ω–≥:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∫–æ–Ω—Ñ–ª–∏–∫—Ç –º–∞—Ä—à—Ä—É—Ç–æ–≤ `/profile/stats` –∏ `/profile/:id`.

## 2026-02-09

### –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è ‚Äî –∞–Ω—Ç–∏—Å–ø–∞–º
- **–ó–∞—â–∏—Ç–∞:** –Ω–µ —á–∞—â–µ 1 –æ—Ç–º–µ—Ç–∫–∏ –Ω–∞ –¥–µ–π—Å—Ç–≤–∏–µ —Ä–∞–∑ –≤ 10 –º–∏–Ω—É—Ç
- **–ú–æ–¥–∞–ª–∫–∞:** –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–µ ‚Äî –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ —Å –æ–±—Ä–∞—Ç–Ω—ã–º –æ—Ç—Å—á—ë—Ç–æ–º –∏ –∫–Ω–æ–ø–∫–æ–π ¬´–û–∫¬ª
- **–ë–µ–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:** –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–º–µ—Ç–∫–µ ‚Äî —Ç–∏—Ö–æ, —Ç–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–æ–≤

### –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è ‚Äî –ø–æ–∏—Å–∫ –∏ –ø–æ—Ä—è–¥–æ–∫
- **–ü–æ–∏—Å–∫:** —Å—Ç—Ä–æ–∫–∞ –ø–æ–∏—Å–∫–∞ –Ω–∞–¥ —Å–ø–∏—Å–∫–æ–º, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∏ –≤–≤–æ–¥–µ (–ø–æ –ø–æ–¥—Å—Ç—Ä–æ–∫–µ, –±–µ–∑ —É—á—ë—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞)
- **–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫:** –æ—Ç–º–µ—á–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–¥–Ω–∏–º–∞—é—Ç—Å—è –≤–≤–µ—Ä—Ö –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–°–∫—Ä–æ–ª–ª:** —Å–ø–∏—Å–æ–∫ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –ø–æ –≤—ã—Å–æ—Ç–µ (~10 –≤–∏–¥–∏–º—ã—Ö), –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî –ø—Ä–æ–∫—Ä—É—Ç–∫–∞

### –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫
- **–ú–∏–≥—Ä–∞—Ü–∏–∏:** –¥–æ–±–∞–≤–ª–µ–Ω–æ ~150 –¥–µ–π—Å—Ç–≤–∏–π (–µ–¥–∞, –Ω–∞–ø–∏—Ç–∫–∏, –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ, —ç–º–æ—Ü–∏–∏, –∑–¥–æ—Ä–æ–≤—å–µ, —Å–ø–æ—Ä—Ç, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç)
- **–ö–∞—Ç–µ–≥–æ—Ä–∏–∏:** —ç–º–æ—Ü–∏–∏ (–≥—Ä—É—â—É, –≤–µ—Å–µ–ª—é—Å—å‚Ä¶), –∑–¥–æ—Ä–æ–≤—å–µ (–∑–∞–±–æ–ª–µ–ª, –ø—Ä–æ—Å—Ç—É–¥–∏–ª—Å—è‚Ä¶), —Å–ø–æ—Ä—Ç, –≤–∏–¥—ã —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞

### –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è ‚Äî UI
- **–ö–Ω–æ–ø–∫–∞:** ¬´–Ø —Ç–æ–∂–µ¬ª ‚Üí ¬´–û—Ç–º–µ—Ç–∏—Ç—å—Å—è¬ª, —à–∏—Ä–∏–Ω–∞ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É
- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –Ω–∞–∑–≤–∞–Ω–∏–µ ‚Äî —Å—á—ë—Ç—á–∏–∫ ‚Äî –∫–Ω–æ–ø–∫–∞ (—Å–ª–µ–≤–∞ –Ω–∞–ø—Ä–∞–≤–æ), —É–±—Ä–∞–Ω–æ ¬´—á–µ–ª.¬ª

### –®–∞–±–ª–æ–Ω—ã
- **Fix:** `onclick="markAction({{ action.id }})"` –≤—ã–∑—ã–≤–∞–ª –æ—à–∏–±–∫—É ‚Äî –∑–∞–º–µ–Ω—ë–Ω –Ω–∞ `data-action-id` –∏ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π

### –ë–µ–π–¥–∂ —á–∞—Ç–∞ ‚Äî –º–æ—Ä–≥–∞–Ω–∏–µ
- **Issue:** –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤–∫–ª–∞–¥–æ–∫ –±–µ–π–¥–∂ –º–µ–ª—å–∫–∞–ª —Å ¬´0¬ª
- **Fix:** –±–µ–π–¥–∂ —Å–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (`display: none`), –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞ API –ø—Ä–∏ `count > 0`
- **Files:** `base.html`

## 2026-01-27

### Mobile App - Login Fix
- **Issue:** Mobile app couldn't connect to backend, "Network Error"
- **Root cause:** Docker port mapping `5433:3000` ‚Üí mobile tried `:3000`, but host exposed `:5433`
- **Fix:** Changed `docker-compose.yml` ports to `3000:3000` for consistent access
- **Files:** `infra/docker-compose.yml`

### Backend - Mobile API Support
- **Added:** `access_token` in JSON response for `/api/auth/login` and `/api/auth/register`
- **Before:** Only set HttpOnly cookie (for web), mobile had no token
- **After:** Returns `{ ok: true, access_token, user }` for both web + mobile
- **Added:** Detailed logging in `auth.controller.ts` (login attempts, success/fail)
- **TypeScript fix:** Added `error: any` type in catch block
- **Files:** `auth.controller.ts`, `auth.service.ts`

### Mobile App - Debug Logging
- **Added:** Comprehensive console logging in auth flow
- **Logs:** API URL, request/response data, error details (network/server/unknown)
- **UI:** Better error messages in alerts (network vs server errors)
- **Files:** `src/services/auth.ts`, `src/screens/LoginScreen.tsx` (mobile project)

### Network Access
- **Setup:** Backend listens on `0.0.0.0:3000` (all interfaces)
- **Access:** `http://localhost:3000` (web), `http://10.128.105.4:3000` (mobile)
- **Note:** May require Windows Firewall rule for port 3000 incoming connections

## 2026-01-24

### Sidebar Redesign
- **Left/Right:** `#faf8f5` bg (was gradient)
- **Left avatar:** 60px (was 80px)
- **Right stats:** horizontal layout (text left, number right, 20px font)
- **Issue:** inline styles in `base.html` overrode `style.css` ‚Üí removed inline
- **Files:** `style.css`, `base.html` (CSS v12)

### Button Fix (My Actions)
- **Active action:** `[+]` icon only, disabled, opacity 0.5
- **Expired action:** `[‚Üª] –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å`, enabled, opacity 1
- **Logic:** `updateCountdowns()` checks `left > 0` ‚Üí sets disabled state
- **Files:** `my_actions.js`

### Blink Fix (Main Page)
- **Issue:** "–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π" rerendered every 1s
- **Fix:** check `textContent.trim()` before `innerHTML =`
- **Files:** `main.html`, `index.html`

### World Badge (prev)
- **Logic:** shows count of NEW actions since `lastViewedWorldAt`
- **Updates:** realtime via `world:actions:refresh` event ‚Üí fetch `/unseen-actions-count`
- **Check:** every 5s + on page load
- **Mark viewed:** `POST /mark-viewed` on world page open
- **Arch:** server-side count (single source of truth), not client +1

### UI Theme (prev)
- **Colors:** beige/cream with brown accents
- **Vars:** `--bg-primary: #f5f3f0`, `--accent-primary: #8b6f47`
- **Tabs:** world page (daily/happening), friends page (tabs for requests/friends/subs)
- **Compact:** my_actions cards (1 line, "–î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ" below)

### Tech Stack
- **Backend:** NestJS + Prisma + PostgreSQL + Socket.IO
- **Frontend:** Vanilla JS + Nunjucks + CSS vars
- **Auth:** JWT + Passport
- **Deploy:** Docker

### Key Files
- `style.css` - theme, sidebar, cards
- `my_actions.js` - dynamic render, button logic
- `socket.js` - WS client, badge updates
- `base.html` - layout, sidebar HTML
- `world.service.ts` - badge count logic
- `realtime.gateway.ts` - WS server

### Notes
- Sidebar collapsed state: `localStorage`
- CSS versioning: `?v=12` for cache bust
- Media query: right sidebar hidden <1000px (was 1200px)
