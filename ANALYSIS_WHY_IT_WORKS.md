# üîç –ê–Ω–∞–ª–∏–∑: –ü–æ—á–µ–º—É —Ä–∞–±–æ—Ç–∞—é—â–∞—è –≤–µ—Ä—Å–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç, –∞ –Ω–∞—à–∞ - –Ω–µ—Ç

## ‚úÖ –ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏

### 1. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è)**

```
Backend                   WebSocket                Frontend
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ     ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ        ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
publishAction()    ‚Üí     'world:actions:refresh'  ‚Üí  updateWorldBadgeCount()
                                ‚Üì
                         –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏         ‚Üí  fetch('/api/world/unseen-actions-count')
                                                         ‚Üì
                                                    Backend —Å—á–∏—Ç–∞–µ—Ç –Ω–µ–ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ
                                                         ‚Üì
                                                    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç count
                                                         ‚Üì
                                                    –ë–µ–π–¥–∂ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
```

---

### 2. **–ö–ª—é—á–µ–≤—ã–µ –æ—Ç–ª–∏—á–∏—è**

#### ‚ùå –ß—Ç–æ –º—ã –¥–µ–ª–∞–ª–∏ (–ù–ï —Ä–∞–±–æ—Ç–∞–ª–æ):

1. **–°–æ–±—ã—Ç–∏–µ:** `world:new_action` —Å –¥–∞–Ω–Ω—ã–º–∏ `{actionId, text, createdAt}`
2. **Frontend –ª–æ–≥–∏–∫–∞:** –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç `currentCount + 1`
3. **–ü—Ä–æ–±–ª–µ–º–∞:** 
   - –ù–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç, –≤–∏–¥–µ–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –î–û –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
   - –ù–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
   - –õ–æ–∫–∞–ª—å–Ω—ã–π —Å—á–µ—Ç—á–∏–∫ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º

```javascript
// ‚ùå –ù–∞—à –ø–æ–¥—Ö–æ–¥ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π)
socket.on('world:new_action', (data) => {
  const currentCount = parseInt(badge.textContent) || 0;
  badge.textContent = currentCount + 1; // –ü—Ä–æ—Å—Ç–æ +1
});
```

#### ‚úÖ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Ä–∞–±–æ—á–∞—è –≤–µ—Ä—Å–∏—è:

1. **–°–æ–±—ã—Ç–∏–µ:** `world:actions:refresh` (–±–µ–∑ –¥–∞–Ω–Ω—ã—Ö)
2. **Frontend –ª–æ–≥–∏–∫–∞:** –ó–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞
3. **Backend:** –°—á–∏—Ç–∞–µ—Ç `createdAt > lastViewedWorldAt` –∏ `expiresAt > now`

```javascript
// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥
socket.on('world:actions:refresh', () => {
  updateWorldBadgeCount(); // –ó–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É
});

async function updateWorldBadgeCount() {
  const res = await fetch('/api/world/unseen-actions-count');
  const data = await res.json();
  badge.textContent = data.count; // –¢–æ—á–Ω—ã–π —Å—á–µ—Ç —Å —Å–µ—Ä–≤–µ—Ä–∞
}
```

---

### 3. **Backend –ª–æ–≥–∏–∫–∞**

#### ‚úÖ –†–∞–±–æ—á–∞—è –≤–µ—Ä—Å–∏—è:

**Endpoint:** `GET /api/world/unseen-actions-count`

```typescript
async getUnseenActiveActionsCount(userId: number): Promise<number> {
  const user = await this.prisma.user.findUnique({
    where: { id: userId },
    select: { lastViewedWorldAt: true },
  });

  if (!user) return 0;

  const now = new Date();
  
  return this.prisma.action.count({
    where: {
      isPublished: true,
      createdAt: { gt: user.lastViewedWorldAt }, // –ü–æ—Å–ª–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
      expiresAt: { gt: now },                    // –ï—â–µ –∞–∫—Ç–∏–≤–Ω–æ
    },
  });
}
```

**–ö–ª—é—á:** –°—á–∏—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–µ–π—Å—Ç–≤–∏—è, –∫–æ—Ç–æ—Ä—ã–µ:
1. –°–æ–∑–¥–∞–Ω—ã **–ø–æ—Å–ª–µ** `lastViewedWorldAt`
2. –ï—â–µ **–∞–∫—Ç–∏–≤–Ω—ã** (`expiresAt > now`)

---

#### ‚ùå –ù–∞—à –ø–æ–¥—Ö–æ–¥ (–ù–ï —Ä–∞–±–æ—Ç–∞–ª):

**Endpoint:** `GET /api/world/active-actions-count` (–Ω–∞—à–∞ –≤–µ—Ä—Å–∏—è)

```typescript
// ‚ùå –ú—ã –ø—ã—Ç–∞–ª–∏—Å—å –¥–µ–ª–∞—Ç—å —Ç–∞–∫
async getNewActionsCount(userId: number) {
  return this.prisma.action.count({
    where: {
      isPublished: true,
      expiresAt: { gt: now },
      createdAt: { gt: lastViewed },
    },
  });
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –õ–æ–≥–∏–∫–∞ –ø–æ—Ö–æ–∂–∞, –ù–û:
- WebSocket —Å–æ–±—ã—Ç–∏–µ `world:new_action` –ø—Ä–∏—Ö–æ–¥–∏—Ç **—Å –¥–∞–Ω–Ω—ã–º–∏**
- Frontend –ø—ã—Ç–∞–ª—Å—è –¥–µ–ª–∞—Ç—å **–ª–æ–∫–∞–ª—å–Ω—ã–π –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç** –≤–º–µ—Å—Ç–æ –∑–∞–ø—Ä–æ—Å–∞
- –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

---

### 4. **WebSocket —Å–æ–±—ã—Ç–∏—è**

#### ‚úÖ –†–∞–±–æ—á–∞—è –≤–µ—Ä—Å–∏—è:

```typescript
// Backend (world.service.ts)
async publishAction(...) {
  // ... –ø—É–±–ª–∏–∫–∞—Ü–∏—è –¥–µ–π—Å—Ç–≤–∏—è ...
  this.rt.emitToAll('world:actions:refresh'); // –ë–ï–ó –¥–∞–Ω–Ω—ã—Ö!
}

async deleteAction(...) {
  // ... —É–¥–∞–ª–µ–Ω–∏–µ ...
  if (wasActive) {
    this.rt.emitToAll('world:actions:refresh'); // –ë–ï–ó –¥–∞–Ω–Ω—ã—Ö!
  }
}
```

**–ü—Ä–∏–Ω—Ü–∏–ø:** –°–µ—Ä–≤–µ—Ä **–ù–ï** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ, —Ç–æ–ª—å–∫–æ **—Å–∏–≥–Ω–∞–ª** –æ–±–Ω–æ–≤–∏—Ç—å—Å—è!

---

#### ‚ùå –ù–∞—à –ø–æ–¥—Ö–æ–¥:

```typescript
// ‚ùå –ú—ã –¥–µ–ª–∞–ª–∏ —Ç–∞–∫
async publishAction(...) {
  this.rt.emitToAll('world:new_action', {
    actionId: updated.id,
    text: updated.text,
    createdAt: updated.createdAt,
  });
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** 
- –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
- Frontend –ø—ã—Ç–∞–µ—Ç—Å—è —Å–∞–º —Ä–µ—à–∏—Ç—å, —á—Ç–æ –¥–µ–ª–∞—Ç—å
- –ù–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º

---

### 5. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞**

#### ‚úÖ –†–∞–±–æ—á–∞—è –≤–µ—Ä—Å–∏—è:

```javascript
// base.html
async function updateWorldBadgeCount() {
  // –ï—Å–ª–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ "–ù–∞—à –º–∏—Ä"
  if (window.location.pathname.startsWith('/api/world/view')) {
    badge.style.display = 'none';
    // –û—Ç–º–µ—á–∞–µ–º –ø—Ä–æ—Å–º–æ—Ç—Ä –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
    await fetch('/api/world/mark-seen', { method: 'POST' });
    return;
  }
  
  // –ù–∞ –¥—Ä—É–≥–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö - –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫
  const res = await fetch('/api/world/unseen-actions-count');
  // ...
}
```

**Backend:**
```typescript
async markWorldActionsAsSeen(userId: number) {
  await this.prisma.user.update({
    where: { id: userId },
    data: { lastViewedWorldAt: new Date() },
  });
}
```

**–ü—Ä–∏–Ω—Ü–∏–ø:** 
- `lastViewedWorldAt` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –ø—Ä–∏ –∑–∞—Ö–æ–¥–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
- **–ù–ï –ù–£–ñ–ù–û** –≤—ã–∑—ã–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ `markWorldAsViewed()`

---

#### ‚ùå –ù–∞—à –ø–æ–¥—Ö–æ–¥:

```javascript
// ‚ùå –ú—ã –¥–µ–ª–∞–ª–∏ —Ç–∞–∫
document.addEventListener('DOMContentLoaded', () => {
  if (typeof window.markWorldAsViewed === 'function') {
    window.markWorldAsViewed(); // –†—É—á–Ω–æ–π –≤—ã–∑–æ–≤
  }
});
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –§—É–Ω–∫—Ü–∏—è –º–æ–∂–µ—Ç –Ω–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è –≤–æ–≤—Ä–µ–º—è
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –ø–æ—Ä—è–¥–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å

---

## üö® –ü–æ—á–µ–º—É –Ω–∞—à –ø–æ–¥—Ö–æ–¥ –ù–ï —Ä–∞–±–æ—Ç–∞–ª

### –ü—Ä–æ–±–ª–µ–º–∞ 1: **–û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–µ–∑ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏**

```javascript
// ‚ùå –ù–∞—à –∫–æ–¥
socket.on('world:new_action', (data) => {
  const currentCount = parseInt(badge.textContent) || 0;
  badge.textContent = currentCount + 1; // +1 –ª–æ–∫–∞–ª—å–Ω–æ
});
```

**–°—Ü–µ–Ω–∞—Ä–∏–π –ø—Ä–æ–≤–∞–ª–∞:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å A –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å–∞–π—Ç ‚Üí badge = 5
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å B –ø—É–±–ª–∏–∫—É–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ ‚Üí WebSocket ‚Üí badge = 6 (–ª–æ–∫–∞–ª—å–Ω–æ)
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å A –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É ‚Üí fetch ‚Üí —Å–µ—Ä–≤–µ—Ä –≥–æ–≤–æ—Ä–∏—Ç: 3 (–ø–æ—Ç–æ–º—É —á—Ç–æ A —É–∂–µ –≤–∏–¥–µ–ª 3 –∏–∑ –Ω–∏—Ö)
4. **–†–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è!** –ë—ã–ª–æ 6, —Å—Ç–∞–ª–æ 3

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: **–°–ª–æ–∂–Ω–æ—Å—Ç—å —Å –∏—Å—Ç–µ—á–µ–Ω–∏–µ–º**

```javascript
// ‚ùå –ù–∞—à –ø–æ–¥—Ö–æ–¥
setInterval(() => {
  updateWorldBadge(); // fetch
}, 5000);
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –î–µ–π—Å—Ç–≤–∏–µ –∏—Å—Ç–µ–∫–ª–æ –≤ 10:05:01
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥: 10:05:05
- –ë–µ–π–¥–∂ –æ—Å—Ç–∞–µ—Ç—Å—è +1 –ª–∏—à–Ω–∏–π –Ω–∞ 4 —Å–µ–∫—É–Ω–¥—ã
- –ü—Ä–∏ –ª–æ–∫–∞–ª—å–Ω–æ–º –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–µ (+1) —ç—Ç–æ –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è!

---

### –ü—Ä–æ–±–ª–µ–º–∞ 3: **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è**

```javascript
// ‚ùå –°—Ü–µ–Ω–∞—Ä–∏–π
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å B –ø—É–±–ª–∏–∫—É–µ—Ç 3 –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–¥—Ä—è–¥
publishAction(1) ‚Üí WebSocket ‚Üí badge +1 = 1
publishAction(2) ‚Üí WebSocket ‚Üí badge +1 = 2
publishAction(3) ‚Üí WebSocket ‚Üí badge +1 = 3

// –ù–û –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å A —É–∂–µ –≤–∏–¥–µ–ª –¥–µ–π—Å—Ç–≤–∏–µ 1 –∏ 2!
// –†–µ–∞–ª—å–Ω—ã–π count = 1, –∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º 3
```

---

## ‚úÖ –ü–æ—á–µ–º—É —Ä–∞–±–æ—Ç–∞—é—â–∞—è –≤–µ—Ä—Å–∏—è –†–ê–ë–û–¢–ê–ï–¢

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ 1: **Single Source of Truth**

```javascript
// ‚úÖ –í—Å–µ–≥–¥–∞ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å —Å–µ—Ä–≤–µ—Ä–∞
socket.on('world:actions:refresh', () => {
  updateWorldBadgeCount(); // –°–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –ó–ê–ù–û–í–û
});
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ–≥–¥–∞ —Ç–æ—á–Ω—ã–π —Å—á–µ—Ç—á–∏–∫!

---

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ 2: **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**

```typescript
// Backend
return this.prisma.action.count({
  where: {
    createdAt: { gt: user.lastViewedWorldAt },
    expiresAt: { gt: now },
  },
});
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ò—Å—Ç–µ–∫—à–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–∫–ª—é—á–∞—é—Ç—Å—è
- –ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–∫–ª—é—á–∞—é—Ç—Å—è
- –ù–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫

---

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ 3: **–ü—Ä–æ—Å—Ç–æ—Ç–∞**

```javascript
// ‚úÖ –†–∞–±–æ—á–∞—è –≤–µ—Ä—Å–∏—è (–ø—Ä–æ—Å—Ç–æ!)
socket.on('world:actions:refresh', () => {
  updateWorldBadgeCount();
});
```

vs

```javascript
// ‚ùå –ù–∞—à –ø–æ–¥—Ö–æ–¥ (—Å–ª–æ–∂–Ω–æ!)
socket.on('world:new_action', (data) => {
  if (!isWorldPage) {
    const badge = document.getElementById('world-badge');
    if (badge) {
      const currentCount = parseInt(badge.textContent) || 0;
      updateWorldBadgeDisplay(currentCount + 1);
    }
  } else {
    if (typeof window.refreshPublished === 'function') {
      window.refreshPublished();
    }
    if (typeof window.markWorldAsViewed === 'function') {
      window.markWorldAsViewed();
    }
  }
});
```

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ù–∞—à –ø–æ–¥—Ö–æ–¥:

| –°–æ–±—ã—Ç–∏–µ | –ó–∞–ø—Ä–æ—Å—ã | –ü—Ä–æ–±–ª–µ–º—ã |
|---------|---------|----------|
| –ü—É–±–ª–∏–∫–∞—Ü–∏—è | 0 | ‚ùå –†–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è |
| –ò—Å—Ç–µ—á–µ–Ω–∏–µ | 1 –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫ | ‚ùå –ó–∞–¥–µ—Ä–∂–∫–∞, –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ |
| –ü—Ä–æ—Å–º–æ—Ç—Ä | 1 | ‚ùå –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –ø–æ—Ä—è–¥–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ |

---

### –†–∞–±–æ—á–∞—è –≤–µ—Ä—Å–∏—è:

| –°–æ–±—ã—Ç–∏–µ | –ó–∞–ø—Ä–æ—Å—ã | –ü—Ä–æ–±–ª–µ–º—ã |
|---------|---------|----------|
| –ü—É–±–ª–∏–∫–∞—Ü–∏—è | 1 | ‚úÖ –í—Å–µ–≥–¥–∞ —Ç–æ—á–Ω–æ |
| –ò—Å—Ç–µ—á–µ–Ω–∏–µ | 1 –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫ | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—á—Ç–µ–Ω–æ |
| –ü—Ä–æ—Å–º–æ—Ç—Ä | 1 | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ |

---

## üéØ –í—ã–≤–æ–¥

### –ü–æ—á–µ–º—É –ù–ï —Ä–∞–±–æ—Ç–∞–ª–æ:

1. **–û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** –±–µ–∑ —É—á–µ—Ç–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞
2. **–õ–æ–∫–∞–ª—å–Ω—ã–π –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç** –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç –æ—à–∏–±–∫–∏
3. **–°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞** –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, —É—Å–ª–æ–≤–∏—è, fallback)
4. **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –ø–æ—Ä—è–¥–∫–∞** –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤

---

### –ü–æ—á–µ–º—É –†–ê–ë–û–¢–ê–ï–¢:

1. **Single Source of Truth** - —Å–µ—Ä–≤–µ—Ä –≤—Å–µ–≥–¥–∞ –∑–Ω–∞–µ—Ç —Ç–æ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
2. **–ü—Ä–æ—Å—Ç–æ–µ —Å–æ–±—ã—Ç–∏–µ** - —Ç–æ–ª—å–∫–æ —Å–∏–≥–Ω–∞–ª `refresh`, –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á–µ—Ç** - —Å–µ—Ä–≤–µ—Ä —É—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å–µ —É—Å–ª–æ–≤–∏—è
4. **–ú–∏–Ω–∏–º—É–º –ª–æ–≥–∏–∫–∏** –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ - —Ç–æ–ª—å–∫–æ fetch –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ

---

## üí° –£—Ä–æ–∫–∏

### –£—Ä–æ–∫ 1: **–ù–µ –ø—ã—Ç–∞–π—Ç–µ—Å—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ**

‚ùå –ù–ï –¥–µ–ª–∞–π—Ç–µ —Ç–∞–∫:
```javascript
currentCount + 1
```

‚úÖ –î–µ–ª–∞–π—Ç–µ —Ç–∞–∫:
```javascript
fetch('/api/count').then(data => data.count)
```

---

### –£—Ä–æ–∫ 2: **WebSocket –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π, API –¥–ª—è –¥–∞–Ω–Ω—ã—Ö**

‚ùå –ù–ï –¥–µ–ª–∞–π—Ç–µ —Ç–∞–∫:
```javascript
socket.on('event', (data) => {
  processData(data); // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ WebSocket
});
```

‚úÖ –î–µ–ª–∞–π—Ç–µ —Ç–∞–∫:
```javascript
socket.on('event', () => {
  fetchData(); // –ó–∞–ø—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ API
});
```

---

### –£—Ä–æ–∫ 3: **–ü—Ä–æ—Å—Ç–æ—Ç–∞ > –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**

–ú—ã –ø—ã—Ç–∞–ª–∏—Å—å —Å–¥–µ–ª–∞—Ç—å "–º–≥–Ω–æ–≤–µ–Ω–Ω–æ" (0ms –∑–∞–¥–µ—Ä–∂–∫–∞), –Ω–æ –ø–æ–ª—É—á–∏–ª–∏:
- –†–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
- –°–ª–æ–∂–Ω—ã–π –∫–æ–¥
- –ú–Ω–æ–≥–æ –±–∞–≥–æ–≤

–†–∞–±–æ—á–∞—è –≤–µ—Ä—Å–∏—è –¥–µ–ª–∞–µ—Ç fetch (~100ms), –Ω–æ:
- –í—Å–µ–≥–¥–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ü—Ä–æ—Å—Ç–æ–π –∫–æ–¥
- –ù–µ—Ç –±–∞–≥–æ–≤

**100ms –∑–∞–¥–µ—Ä–∂–∫–∏ < —á–∞—Å—ã –æ—Ç–ª–∞–¥–∫–∏!**

---

*–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞: 23 —è–Ω–≤–∞—Ä—è 2026*
