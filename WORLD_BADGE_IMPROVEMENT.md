# üéØ –£–ª—É—á—à–µ–Ω–∏–µ –±–µ–π–¥–∂–∞ "–ù–∞—à –º–∏—Ä" - –°–∏—Å—Ç–µ–º–∞ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π

## –û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è **–Ω–æ–≤—ã—Ö –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö** –¥–µ–π—Å—Ç–≤–∏–π, –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–µ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.

## –ö–∞–∫ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞**
- –í –ë–î —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è `lastViewedWorldAt` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã "–ù–∞—à –º–∏—Ä" —ç—Ç–æ –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
- –ë–µ–π–¥–∂ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–µ–π—Å—Ç–≤–∏—è, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ **–ø–æ—Å–ª–µ** –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞

### 2. **–õ–æ–≥–∏–∫–∞ –ø–æ–∫–∞–∑–∞ –±–µ–π–¥–∂–∞**

#### ‚úÖ –ë–µ–π–¥–∂ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∫–æ–≥–¥–∞:
- –ö—Ç–æ-—Ç–æ –ø—É–±–ª–∏–∫—É–µ—Ç –Ω–æ–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å **–ù–ï** –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ "–ù–∞—à –º–∏—Ä"
- –î–µ–π—Å—Ç–≤–∏–µ —Å–æ–∑–¥–∞–Ω–æ –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

#### ‚ùå –ë–µ–π–¥–∂ –ù–ï –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∫–æ–≥–¥–∞:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ "–ù–∞—à –º–∏—Ä"
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –≤–∏–¥–µ–ª —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ (–ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–ª —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ—Å–ª–µ –µ–≥–æ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏)
- –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –∏—Å—Ç—ë–∫ (`expiresAt < now`)

### 3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–∞**
- –ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π
- –ï—Å–ª–∏ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –∏—Å—Ç—ë–∫ - –æ–Ω–æ –∏—Å–∫–ª—é—á–∞–µ—Ç—Å—è –∏–∑ —Å—á—ë—Ç—á–∏–∫–∞
- –ë–µ–π–¥–∂ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∏–ª–∏ –∏—Å—á–µ–∑–∞–µ—Ç

---

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### Backend

#### 1. **`world.controller.ts`** - –Ω–æ–≤—ã–µ endpoints

**–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –Ω–æ–≤—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π:**
```typescript
@Get('active-actions-count')
async getActiveActionsCount(@CurrentUser() user: AuthUser) {
  const count = await this.service.getNewActionsCount(user.userId);
  return { count };
}
```

**–û—Ç–º–µ—Ç–∫–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:**
```typescript
@Post('mark-viewed')
async markWorldAsViewed(@CurrentUser() user: AuthUser) {
  await this.prisma.user.update({
    where: { id: user.userId },
    data: { lastViewedWorldAt: new Date() },
  });
  return { ok: true };
}
```

#### 2. **`world.service.ts`** - –Ω–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –ø–æ–¥—Å—á—ë—Ç–∞

```typescript
async getNewActionsCount(userId: number) {
  const user = await this.prisma.user.findUnique({
    where: { id: userId },
    select: { lastViewedWorldAt: true },
  });

  if (!user) return 0;

  const lastViewed = user.lastViewedWorldAt || new Date(0);
  const now = new Date();

  return this.prisma.action.count({
    where: {
      isPublished: true,
      expiresAt: { gt: now },        // –ï—â—ë –∞–∫—Ç–∏–≤–Ω–æ
      createdAt: { gt: lastViewed },  // –°–æ–∑–¥–∞–Ω–æ –ø–æ—Å–ª–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
    },
  });
}
```

---

### Frontend

#### 1. **`socket.js`** - –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞

**–§—É–Ω–∫—Ü–∏—è –æ—Ç–º–µ—Ç–∫–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞:**
```javascript
async function markWorldAsViewed() {
  await fetch('/api/world/mark-viewed', { 
    method: 'POST', 
    credentials: 'include' 
  });
  updateWorldBadgeDisplay(0);
}
```

**–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:**
```javascript
// –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ù–ï –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ "–ù–∞—à –º–∏—Ä")
setInterval(() => {
  if (!window.location.pathname.includes('/world/')) {
    updateWorldBadge();
  }
}, 60000);
```

**–£—Å–ª–æ–≤–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:**
```javascript
// –û–±–Ω–æ–≤–ª—è–µ–º –±–µ–π–¥–∂ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ù–ï –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ "–ù–∞—à –º–∏—Ä"
if (window.CURRENT_USER_ID && !window.location.pathname.includes('/world/')) {
  updateWorldBadge();
}
```

#### 2. **`world.html`** - –≤—ã–∑–æ–≤ –æ—Ç–º–µ—Ç–∫–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞

```javascript
document.addEventListener('DOMContentLoaded', () => {
  if (typeof window.markWorldAsViewed === 'function') {
    window.markWorldAsViewed();
  }
});
```

---

## –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–≤–æ–µ –ø–æ—Å–µ—â–µ–Ω–∏–µ
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–ø–µ—Ä–≤—ã–µ –∑–∞—Ö–æ–¥–∏—Ç –Ω–∞ —Å–∞–π—Ç
2. `lastViewedWorldAt = null` (–∏–ª–∏ –¥–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)
3. –ë–µ–π–¥–∂ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç **–≤—Å–µ** –∞–∫—Ç–∏–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç "–ù–∞—à –º–∏—Ä"
5. `lastViewedWorldAt` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
6. –ë–µ–π–¥–∂ –∏—Å—á–µ–∑–∞–µ—Ç

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ù–æ–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
2. –ö—Ç–æ-—Ç–æ –ø—É–±–ª–∏–∫—É–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ (10:00)
3. WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ `world:new_action`
4. –ë–µ–π–¥–∂ –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Å —Ü–∏—Ñ—Ä–æ–π 1
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ –¥—Ä—É–≥–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã - –±–µ–π–¥–∂ –æ—Å—Ç–∞—ë—Ç—Å—è
6. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç "–ù–∞—à –º–∏—Ä" (10:05)
7. `lastViewedWorldAt = 10:05`
8. –ë–µ–π–¥–∂ –∏—Å—á–µ–∑–∞–µ—Ç
9. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é - –±–µ–π–¥–∂ –ù–ï –ø–æ—è–≤–ª—è–µ—Ç—Å—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ò—Å—Ç–µ—á–µ–Ω–∏–µ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –±–µ–π–¥–∂ "3"
2. –¢—Ä–∏ –¥–µ–π—Å—Ç–≤–∏—è —Å –∏—Å—Ç–µ—á–µ–Ω–∏–µ–º: 10:00, 10:05, 10:10
3. –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è 10:03
4. –ß–µ—Ä–µ–∑ –º–∏–Ω—É—Ç—É (10:04) - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
5. –î–µ–π—Å—Ç–≤–∏–µ —Å –∏—Å—Ç–µ—á–µ–Ω–∏–µ–º 10:00 –∏—Å–∫–ª—é—á–∞–µ—Ç—Å—è
6. –ë–µ–π–¥–∂ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–∞ "2"
7. –í 10:06 - –±–µ–π–¥–∂ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è "1"
8. –í 10:11 - –±–µ–π–¥–∂ –∏—Å—á–µ–∑–∞–µ—Ç (–≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –∏—Å—Ç–µ–∫–ª–∏)

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ "–ù–∞—à –º–∏—Ä"
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç "–ù–∞—à –º–∏—Ä" (10:00)
2. `lastViewedWorldAt = 10:00`
3. –ö—Ç–æ-—Ç–æ –ø—É–±–ª–∏–∫—É–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ (10:05)
4. –ë–µ–π–¥–∂ **–ù–ï** –ø–æ—è–≤–ª—è–µ—Ç—Å—è (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ)
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –Ω–æ–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –≤ —Å–ø–∏—Å–∫–µ
6. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é (10:10)
7. –ë–µ–π–¥–∂ **–ù–ï** –ø–æ—è–≤–ª—è–µ—Ç—Å—è (`lastViewedWorldAt = 10:00`, –Ω–æ –¥–µ–π—Å—Ç–≤–∏–µ –≤–∏–¥–µ–ª–∏ –≤ —Å–ø–∏—Å–∫–µ)
8. –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ (10:11) - API –≤–µ—Ä–Ω—ë—Ç 0

**–í–ê–ñ–ù–û:** –î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —ç—Ç–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å `lastViewedWorldAt` –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã "–ù–∞—à –º–∏—Ä".

---

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

### ‚úÖ –ß—Ç–æ —É–ª—É—á—à–∏–ª–æ—Å—å:

1. **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è** - –∫–∞–∂–¥—ã–π –≤–∏–¥–∏—Ç —Å–≤–æ–∏ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
2. **–ù–µ—Ç —Å–ø–∞–º–∞** - –±–µ–π–¥–∂ –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –¥–ª—è —É–∂–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** - –∏—Å—Ç—ë–∫—à–∏–µ –¥–µ–π—Å—Ç–≤–∏—è —É–±–∏—Ä–∞—é—Ç—Å—è –∏–∑ —Å—á—ë—Ç—á–∏–∫–∞
4. **–£–º–Ω–æ–µ —Å–∫—Ä—ã—Ç–∏–µ** - –±–µ–π–¥–∂ –Ω–µ –º–µ—à–∞–µ—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ "–ù–∞—à –º–∏—Ä"
5. **–ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å** - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ (–Ω–µ –∏—Å—Ç—ë–∫—à–∏–µ) –¥–µ–π—Å—Ç–≤–∏—è

### üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

- **1 –∑–∞–ø—Ä–æ—Å** –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- **1 –∑–∞–ø—Ä–æ—Å** –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ "–ù–∞—à –º–∏—Ä"
- **1 –∑–∞–ø—Ä–æ—Å** –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å—Ç–µ—á–µ–Ω–∏—è
- **WebSocket —Å–æ–±—ã—Ç–∏–µ** –ø—Ä–∏ –Ω–æ–≤–æ–º –¥–µ–π—Å—Ç–≤–∏–∏

---

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ò—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ –ø–æ–ª–µ:
```sql
lastViewedWorldAt TIMESTAMP DEFAULT NOW()
```

### –ó–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–¥—Å—á—ë—Ç–∞:
```sql
SELECT COUNT(*) FROM "Action"
WHERE "isPublished" = true
  AND "expiresAt" > NOW()
  AND "createdAt" > (
    SELECT "lastViewedWorldAt" 
    FROM "User" 
    WHERE "id" = $userId
  )
```

---

## API Endpoints

### 1. –ü–æ–ª—É—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–≤—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
```
GET /api/world/active-actions-count
Authorization: JWT Cookie

Response:
{
  "count": 3
}
```

### 2. –û—Ç–º–µ—Ç–∏—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä
```
POST /api/world/mark-viewed
Authorization: JWT Cookie

Response:
{
  "ok": true
}
```

---

## WebSocket Events

### 1. –ù–æ–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ
```javascript
socket.on('world:new_action', (data) => {
  // data: { actionId, text, createdAt }
  updateWorldBadge(); // –ó–∞–ø—Ä–æ—Å –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å—á—ë—Ç—á–∏–∫–∞
});
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –ë–∞–∑–æ–≤—ã–π —Ñ–ª–æ—É
1. ‚úÖ –û—Ç–∫—Ä–æ–π—Ç–µ –≥–ª–∞–≤–Ω—É—é - –±–µ–π–¥–∂ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
2. ‚úÖ –û—Ç–∫—Ä–æ–π—Ç–µ "–ù–∞—à –º–∏—Ä" - –±–µ–π–¥–∂ –∏—Å—á–µ–∑–∞–µ—Ç
3. ‚úÖ –í–µ—Ä–Ω–∏—Ç–µ—Å—å –Ω–∞ –≥–ª–∞–≤–Ω—É—é - –±–µ–π–¥–∂ –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è
4. ‚úÖ –û–ø—É–±–ª–∏–∫—É–π—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –≤ –¥—Ä—É–≥–æ–º –±—Ä–∞—É–∑–µ—Ä–µ - –±–µ–π–¥–∂ –ø–æ—è–≤–ª—è–µ—Ç—Å—è

### –¢–µ—Å—Ç 2: –ò—Å—Ç–µ—á–µ–Ω–∏–µ
1. ‚úÖ –û–ø—É–±–ª–∏–∫—É–π—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–∞ 1 –º–∏–Ω—É—Ç—É
2. ‚úÖ –ë–µ–π–¥–∂ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "1"
3. ‚úÖ –ü–æ–¥–æ–∂–¥–∏—Ç–µ 2 –º–∏–Ω—É—Ç—ã
4. ‚úÖ –ë–µ–π–¥–∂ –¥–æ–ª–∂–µ–Ω –∏—Å—á–µ–∑–Ω—É—Ç—å

### –¢–µ—Å—Ç 3: –ù–µ—Å–∫–æ–ª—å–∫–æ –¥–µ–π—Å—Ç–≤–∏–π
1. ‚úÖ –û–ø—É–±–ª–∏–∫—É–π—Ç–µ 3 –¥–µ–π—Å—Ç–≤–∏—è
2. ‚úÖ –ë–µ–π–¥–∂ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "3"
3. ‚úÖ –û—Ç–∫—Ä–æ–π—Ç–µ "–ù–∞—à –º–∏—Ä"
4. ‚úÖ –ë–µ–π–¥–∂ –∏—Å—á–µ–∑–∞–µ—Ç
5. ‚úÖ –û–ø—É–±–ª–∏–∫—É–π—Ç–µ –µ—â—ë 2 –¥–µ–π—Å—Ç–≤–∏—è
6. ‚úÖ –í–µ—Ä–Ω–∏—Ç–µ—Å—å –Ω–∞ –≥–ª–∞–≤–Ω—É—é - –±–µ–π–¥–∂ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "2"

---

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ "–ù–∞—à –º–∏—Ä"**
   - –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–≥–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
   - –ù–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ, –Ω–æ `lastViewedWorldAt` –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
   - **–†–µ—à–µ–Ω–∏–µ:** –æ–±–Ω–æ–≤–ª—è—Ç—å `lastViewedWorldAt` –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞

2. **–¢–æ—á–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å—Ç–µ—á–µ–Ω–∏—è**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑ –≤ –º–∏–Ω—É—Ç—É, –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–æ 60 —Å–µ–∫—É–Ω–¥
   - **–†–µ—à–µ–Ω–∏–µ:** —É–º–µ–Ω—å—à–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å WebSocket

---

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `lastViewedWorldAt`** –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ —Å–ø–∏—Å–∫–∞
2. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –∏—Å—Ç–µ—á–µ–Ω–∏–∏** - WebSocket —Å–æ–±—ã—Ç–∏–µ –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –¥–µ–π—Å—Ç–≤–∏—è
3. **–ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤** - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
4. **–§–∏–ª—å—Ç—Ä—ã** - –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–µ–π—Å—Ç–≤–∏—è –æ—Ç –¥—Ä—É–∑–µ–π/–ø–æ–¥–ø–∏—Å–æ–∫

---

*–û–±–Ω–æ–≤–ª–µ–Ω–æ: 23 —è–Ω–≤–∞—Ä—è 2026*
*–°—Ç–∞—Ç—É—Å: ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ*
